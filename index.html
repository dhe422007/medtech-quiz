<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="manifest" href="./manifest.webmanifest" />
<title>臨床検査技師 国家試験：臨床生理 問題アプリ</title>
<style>
:root{
  --bg:#f6f7fb; --card:#ffffff; --text:#0f172a; --muted:#64748b;
  --accent:#2563eb; --ok:#22c55e; --ng:#ef4444; --ring:#e5e7eb;
}
*{box-sizing:border-box}
html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font:15px/1.7 system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI","Hiragino Sans","Noto Sans JP","Yu Gothic",Meiryo,sans-serif}
.container{max-width:980px;margin:0 auto;padding:16px}
header{position:sticky;top:0;background:rgba(255,255,255,.8);backdrop-filter:saturate(180%) blur(12px);border-bottom:1px solid var(--ring);z-index:10}
h1{margin:0;font-size:20px}
.row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
select,button,input{border:1px solid var(--ring);background:#fff;border-radius:10px;padding:8px 12px;font-size:14px}
button{cursor:pointer}
button.primary{background:var(--accent);color:#fff;border-color:var(--accent)}
button.ghost{background:#fff}
.badge{display:inline-block;padding:4px 10px;border:1px solid var(--ring);border-radius:999px;color:var(--muted);font-size:12px}
.kicker{font-size:12px;color:var(--muted)}
.card{background:var(--card);border:1px solid var(--ring);border-radius:16px;padding:16px;margin:16px 0;box-shadow:0 2px 8px rgba(15,23,42,.04)}
.grid{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:12px}
@media (max-width:900px){ .grid{grid-template-columns:repeat(2,minmax(0,1fr));} }
.tile{border:1px solid var(--ring);background:#fff;border-radius:14px;padding:12px 14px;cursor:pointer;transition:transform .06s ease, box-shadow .06s ease}
.tile:hover{transform:translateY(-1px);box-shadow:0 4px 14px rgba(0,0,0,.06)}
.tile strong{display:block;font-size:15px;margin-bottom:2px}
.tile small{color:var(--muted)}
.progress{height:8px;background:#e5e7eb;border-radius:999px;overflow:hidden}
.progress>span{display:block;height:100%;background:var(--accent);width:0%}
#qImage{max-width:100%;height:auto;border:1px solid var(--ring);border-radius:12px;margin:12px 0}
.tag{display:inline-block;background:#f1f5f9;border:1px solid var(--ring);color:var(--muted);border-radius:999px;padding:2px 8px;margin-right:6px;font-size:12px}
.choice{display:block;width:100%;text-align:left;margin:8px 0;padding:12px 14px;border-radius:12px;border:1px solid var(--ring);background:#fff}
.choice.selected{outline:2px solid var(--accent);background:#eef4ff}
.choice.correct{border-color:var(--ok);outline:2px solid var(--ok);background:#ecfdf5}
.choice.incorrect{border-color:var(--ng);outline:2px solid var(--ng);background:#fef2f2}
.hidden{display:none}
.view{display:none}
.view.active{display:block}
.notice{font-size:12px;color:var(--muted)}
footer{color:var(--muted);font-size:12px;text-align:center;padding:24px}
.table{width:100%;border-collapse:collapse}
.table th,.table td{border:1px solid var(--ring);padding:8px;text-align:left}
.table th{background:#f8fafc}
.headerRight{margin-left:auto;display:flex;gap:8px;align-items:center}
</style>
</head>
<body>
<header>
  <div class="container">
    <div class="row" style="justify-content:space-between;">
      <div>
        <h1>臨床検査技師 国家試験：臨床生理 問題アプリ</h1>
        <div class="kicker">試験日まで <b id="countdown">—</b></div>
      </div>
      <div class="headerRight">
        <button id="goTopBtn" class="primary">トップページへ</button>
        <button id="toStatsBtn" class="primary">成績・弱点</button>
      </div>
    </div>
  </div>
</header>

<main class="container">
  <!-- Top -->
  <section id="viewTop" class="view active">
    <div class="card">
      <div class="row" style="justify-content:space-between;align-items:center;">
        <div class="row">
          <select id="yearFilter" title="年度"><option value="">すべての年度</option></select>
          <select id="tagFilter" title="分野"><option value="">全ての分野</option></select>
          <select id="modeSelect" title="モード">
            <option value="all">全て</option>
            <option value="wrong">間違えた問題のみ</option>
            <option value="bookmarked">ブックマークのみ</option>
          </select>
          <button id="startBtn" class="primary">解答スタート</button>
        </div>
        <div><span class="badge">該当 <b id="matchCount">0</b> 問</span></div>
      </div>
    </div>

    <div class="card">
      <div class="row" style="justify-content:space-between;">
        <h3 style="margin:0">年度</h3>
        <small class="notice">カードをクリックすると年度フィルタが設定されます</small>
      </div>
      <div id="yearGrid" class="grid"></div>
    </div>

    <div class="card">
      <div class="row" style="justify-content:space-between;">
        <h3 style="margin:0">分野</h3>
        <small class="notice">カードをクリックすると分野フィルタが設定されます</small>
      </div>
      <div id="tagGrid" class="grid"></div>
      <p class="notice" style="margin-top:6px;">※ 成績は端末ローカルにのみ保存されます。</p>
    </div>
  </section>

  <!-- Quiz -->
  <section id="viewQuiz" class="view">
    <div class="card" id="quizCard">
      <div class="row" style="justify-content:space-between;margin-bottom:8px;">
        <div><b id="qid">—</b></div>
        <button id="bookmarkBtn" class="ghost">☆ ブックマーク</button>
      </div>
      <h2 id="questionText" style="margin:6px 0 0 0; font-size:18px;"></h2>
      <img id="qImage" class="hidden" alt="">
      <div id="tagsWrap" class="row"></div>
      <div id="choices" style="margin-top:8px;"></div>
      <div id="explain" class="hidden" style="margin-top:12px;"></div>
      <div class="row" style="justify-content:space-between;margin-top:8px;">
        <button id="prevBtn">◀ 前へ</button>
        <button id="nextBtn" class="primary">解答する</button>
      </div>
      <div class="progress" style="margin-top:12px;"><span id="progressBar"></span></div>
      <div class="row" style="gap:12px;margin-top:6px;color:var(--muted);">
        <span>進捗: <b id="progressNum">0/0</b></span>
        <span>正答率: <b id="accuracy">0%</b></span>
        <span>連続正解: <b id="streak">0</b></span>
      </div>
    </div>
  </section>

  <!-- End -->
  <section id="viewEnd" class="view">
    <div class="card" style="text-align:center;">
      <h2>結果</h2>
      <p>今回の正答率：<b id="finalAccuracy">0%</b></p>
      <p id="finalCounts">—</p>
      <p id="finalDate" class="notice"></p>
      <p id="finalDuration" class="notice"></p>

      <div style="text-align:left;margin-top:12px;">
        <h3 style="margin:0 0 6px;">今回の弱点（分野・年度）</h3>
        <div id="weaknessList">—</div>
      </div>

      <div class="row" style="justify-content:center;margin-top:12px;">
        <button id="backHomeBtn" class="primary">トップページに戻る</button>
        <button id="toStatsBtn2" class="ghost">成績・弱点を見る</button>
      </div>
    </div>
  </section>

  <!-- Stats -->
  <section id="viewStats" class="view">
    <div class="card">
      <h2 style="margin-top:0;">成績・弱点</h2>
      <div id="statsOverview">—</div>

      <h3>分野別 成績</h3>
      <table class="table"><thead><tr><th>分野</th><th>正答率</th><th>正解/回答</th></tr></thead><tbody id="statsByTagTbody"></tbody></table>

      <h3 style="margin-top:16px;">年度別 成績</h3>
      <table class="table"><thead><tr><th>年度</th><th>正答率</th><th>正解/回答</th></tr></thead><tbody id="statsByYearTbody"></tbody></table>

      <div class="row" style="margin-top:12px;">
        <button id="reviewWrongsBtn" class="primary">間違いのみでやり直す</button>
        <button id="reviewBookmarksBtn" class="ghost">ブックマークだけでやる</button>
        <button id="resetStatsBtn" class="ghost">学習履歴をリセット</button>
      </div>

      <div style="margin-top:8px;">
        <button id="backTopBtn" class="ghost">← トップへ戻る</button>
      </div>
    </div>
  </section>
</main>

<footer>© 2025 H.U.</footer>

<script src="./app.js?v=24"></script>
<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => navigator.serviceWorker.register('./sw.js'));
  }
</script>
</body>
</html>

